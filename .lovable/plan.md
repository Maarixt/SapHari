

# Plan: Supabase Configuration Alignment and Hardening

## Problem Summary

The project has a naming mismatch between environment variables. The `.env` file uses `VITE_SUPABASE_PUBLISHABLE_KEY` but some code or validation may expect `VITE_SUPABASE_ANON_KEY`. Additionally, `src/integrations/supabase/client.ts` hardcodes the Supabase URL and key (this is Lovable's auto-generated pattern), but there's no runtime safety net if these values ever become stale.

The `process.env.NODE_ENV` usage in `ErrorBoundary.tsx` is harmless (Vite replaces it at build time) but should ideally use `import.meta.env.DEV`.

## Changes

### 1. Add `VITE_SUPABASE_ANON_KEY` alias to `.env`

Add a line aliasing the publishable key so both naming conventions work:
```
VITE_SUPABASE_ANON_KEY="eyJhbG..."
```
This ensures any code expecting either name will find the value.

### 2. Add runtime env validation in `src/integrations/supabase/client.ts`

The auto-generated file hardcodes values, but we'll add a small validation block that warns in development if the env vars are missing (for future-proofing when the project is ejected or self-hosted):

```typescript
const SUPABASE_URL = "https://wrdeomgtkbehvbfhiprm.supabase.co";
const SUPABASE_PUBLISHABLE_KEY = "eyJ...";

// Runtime validation for self-hosted / ejected deployments
if (import.meta.env.DEV) {
  if (!SUPABASE_URL || !SUPABASE_PUBLISHABLE_KEY) {
    console.error(
      'Missing Supabase configuration. ' +
      'Create a .env file with VITE_SUPABASE_URL and VITE_SUPABASE_PUBLISHABLE_KEY, then restart Vite.'
    );
  }
}
```

### 3. Fix `process.env` usage in ErrorBoundary

Replace `process.env.NODE_ENV === 'development'` with `import.meta.env.DEV` in `src/components/ErrorBoundary.tsx` to follow Vite conventions properly.

### 4. Update `.gitignore` to explicitly ignore `.env` files

Add these lines:
```
.env
.env.local
.env.*.local
```

### 5. Hardcoded project ID cleanup in `useAuth.tsx`

Line 160 hardcodes `const projectId = 'wrdeomgtkbehvbfhiprm'`. Replace with:
```typescript
const projectId = import.meta.env.VITE_SUPABASE_PROJECT_ID || 'wrdeomgtkbehvbfhiprm';
```

### 6. Add README snippet

Add a section to `README.md` explaining env setup for Supabase.

## What Will NOT Change

- **`src/integrations/supabase/client.ts` structure**: This is auto-generated by Lovable. We keep the hardcoded values as they are (Lovable manages them), but add dev-mode validation.
- **No new libraries**: All changes use existing code patterns.
- **Schema/RPC/Edge Functions**: These are already aligned with the current Supabase project (verified via the types file and existing functions).
- **RLS patterns**: Already correctly implemented -- all client queries go through RLS, and privileged operations use `SECURITY DEFINER` functions or edge functions.

## Technical Details

Files to modify:
- `.env` -- add `VITE_SUPABASE_ANON_KEY` alias
- `.gitignore` -- add `.env` exclusions
- `src/components/ErrorBoundary.tsx` -- replace `process.env` with `import.meta.env.DEV`
- `src/hooks/useAuth.tsx` -- use env var for project ID
- `README.md` -- add env setup documentation

## How to Verify

1. Run dev server -- no console errors about missing Supabase vars
2. Open browser console -- confirm Supabase client initializes
3. Test login/signup flow -- auth works correctly
4. Test logout -- state resets, no stale data
5. Check that no `process.env` warnings appear in browser console

